<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wave Equation Practice</title>
  <style>
    :root {
      --bg: #0f172a;        /* slate-900 */
      --panel: #111827;     /* gray-900 */
      --ink: #e5e7eb;       /* gray-200 */
      --muted: #94a3b8;     /* slate-400 */
      --accent: #22c55e;    /* green-500 */
      --accent-2: #38bdf8;  /* sky-400 */
      --warning: #f59e0b;   /* amber-500 */
      --error: #ef4444;     /* red-500 */
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; color: var(--ink); background: radial-gradient(1200px 600px at 20% -10%, #1f2937 0, var(--bg) 50%, #0b1022 100%); }
    .wrap { max-width: 900px; margin: 40px auto; padding: 16px; }
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); border: 1px solid rgba(255,255,255,0.08); border-radius: 18px; box-shadow: 0 10px 30px rgba(0,0,0,0.35); overflow: hidden; }
    header { display: flex; align-items: center; justify-content: space-between; gap: 12px; padding: 18px 20px; border-bottom: 1px solid rgba(255,255,255,0.06); }
    header h1 { font-size: 1.2rem; margin: 0; letter-spacing: 0.2px; }
    .pill { font-size: 12px; padding: 4px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.18); color: var(--muted); }

    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 12px; padding: 18px; }
    .panel { grid-column: span 12; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.07); border-radius: 16px; padding: 16px; }
    @media (min-width: 900px) { .left { grid-column: span 7; } .right { grid-column: span 5; } }

    .row { display: flex; flex-wrap: wrap; align-items: center; gap: 10px; margin: 8px 0; }
    .label { color: var(--muted); font-size: 0.9rem; width: 110px; }
    .value { font-weight: 600; font-size: 1.05rem; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-weight: 600; padding: 2px 8px; border-radius: 8px; background: rgba(56,189,248,0.15); border: 1px solid rgba(56,189,248,0.35); color: #e0f2fe; }

    input[type="number"], select, button, input[type="text"] { background: #0b1222; color: var(--ink); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 10px 12px; font-size: 1rem; }
    input[type="number"] { width: 160px; }
    select { min-width: 110px; }
    button { cursor: pointer; transition: transform 0.02s ease, background 0.2s ease, border-color 0.2s ease; }
    button.primary { background: linear-gradient(180deg, rgba(34,197,94,0.15), rgba(34,197,94,0.08)); border-color: rgba(34,197,94,0.45); }
    button.primary:hover { background: rgba(34,197,94,0.25); }
    button.ghost { background: transparent; }

    .status { margin-top: 10px; padding: 12px; border-radius: 12px; font-weight: 600; }
    .ok { background: rgba(34,197,94,0.12); border: 1px solid rgba(34,197,94,0.35); }
    .warn { background: rgba(245,158,11,0.12); border: 1px solid rgba(245,158,11,0.35); }
    .bad { background: rgba(239,68,68,0.12); border: 1px solid rgba(239,68,68,0.35); }

    .steps { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 0.95rem; line-height: 1.5; color: #d1d5db; background: #0a0f1d; border-radius: 12px; padding: 12px; border: 1px solid rgba(255,255,255,0.08); overflow: auto; }

    .meta { display: flex; gap: 10px; flex-wrap: wrap; }
    .meta .box { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.08); padding: 10px 12px; border-radius: 12px; font-size: 0.95rem; }
    .muted { color: var(--muted); }
    .small { font-size: 0.88rem; }
    .center { text-align: center; }
    .hr { height: 1px; background: rgba(255,255,255,0.08); margin: 14px 0; }
    .flex-between { display: flex; justify-content: space-between; align-items: center; gap: 8px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <h1>Wave Equation Practice • <span class="muted">v = f · λ</span></h1>
        <div class="pill" id="modePill">Randomised Units</div>
      </header>

      <div class="grid">
        <section class="panel left">
          <div class="flex-between">
            <div class="meta">
              <div class="box">Score: <strong id="score">0</strong></div>
              <div class="box">Streak: <strong id="streak">0</strong></div>
              <div class="box">Tolerance: <strong id="tol">2%</strong></div>
            </div>
            <div class="meta">
              <label class="small muted">Target sig figs
                <select id="sigfigs">
                  <option value="2">2</option>
                  <option value="3" selected>3</option>
                  <option value="4">4</option>
                </select>
              </label>
              <button class="ghost" id="toggleUnits">Toggle Units: Random</button>
            </div>
          </div>

          <div class="hr"></div>

          <div id="given">
            <!-- Filled by JS -->
          </div>

          <div class="row">
            <div class="label">Your answer:</div>
            <input type="number" id="answer" inputmode="decimal" step="any" placeholder="Enter value" />
            <select id="ansUnit"></select>
            <button class="primary" id="checkBtn">Check</button>
            <button class="ghost" id="newBtn">New Question</button>
          </div>

          <div id="feedback"></div>

          <div class="hr"></div>

          <div class="row">
            <button class="ghost" id="hintBtn">Hint</button>
            <button class="ghost" id="solutionBtn">Show solution</button>
            <button class="ghost" id="copyLinkBtn" title="Copy a shareable link to this question">Share</button>
          </div>
        </section>

        <aside class="panel right">
          <div class="small muted">How it works</div>
          <p class="small">You’ll be shown two of the three quantities. Compute the missing one. Values may use different units. Answers within <strong>±2%</strong> count as correct. Use scientific notation like <span class="kbd">1.2e3</span> if you like.</p>
          <div class="steps" id="steps">Steps will appear here after you check or reveal the solution.</div>
          <div class="status warn small" style="margin-top:12px">Tip: change <em>sig figs</em> to train rounding discipline. We still accept ±2%.</div>
          <div class="hr"></div>
          <div class="small muted">Keyboard</div>
          <p class="small">Press <span class="kbd">Enter</span> to check, <span class="kbd">N</span> for a new question.</p>
        </aside>
      </div>
    </div>

    <p class="center small muted" style="margin-top:16px">Made for physics practice. No tracking, all local.</p>
  </div>

  <script>
    // --- Utility helpers ---
    const rnd = (min, max) => Math.random() * (max - min) + min;
    const choice = (arr) => arr[Math.floor(Math.random() * arr.length)];

    // Unit systems
    const UNITS = {
      v: [ {k:1, label:'m/s'}, {k:1e-3, label:'km/s'}, {k:1e2, label:'cm/s'} ],
      f: [ {k:1, label:'Hz'}, {k:1e3, label:'kHz'}, {k:1e6, label:'MHz'} ],
      lambda: [ {k:1, label:'m'}, {k:1e-3, label:'mm'}, {k:1e-2, label:'cm'} ]
    };

    const SYMBOL = { v:'v', f:'f', lambda:'λ' };
    const NAME = { v:'Wave speed', f:'Frequency', lambda:'Wavelength' };

    const state = {
      question: null,
      score: 0,
      streak: 0,
      tolPct: 2,
      sigfigs: 3,
      unitsRandom: true,
    };

    function toSigFigs(x, n){
      if(!isFinite(x)) return x;
      if(x === 0) return 0;
      const d = Math.ceil(Math.log10(Math.abs(x)));
      const power = n - d;
      const mag = Math.pow(10, power);
      return Math.round(x * mag) / mag;
    }

    function fmt(x, n=3){
      const y = toSigFigs(x, n);
      // Use scientific notation for very big/small
      if(Math.abs(y) >= 1e4 || Math.abs(y) < 1e-2){
        return y.toExponential(n-1);
      }
      return String(y);
    }

    function encodeQuery(obj){
      return new URLSearchParams(obj).toString();
    }

    function decodeQuery(){
      const p = new URLSearchParams(location.search);
      const got = Object.fromEntries(p.entries());
      return Object.keys(got).length? got : null;
    }

    // Create a new random question (two given, solve for missing)
    function makeQuestion(seed=null){
      // Random but controlled ranges for nice numbers
      // Pick base in SI then convert for display
      let f = rnd(30, 3000); // Hz
      let lambda = rnd(0.05, 12); // m
      let v = f * lambda; // m/s

      // pick which variable is missing
      const missing = choice(['v','f','lambda']);

      // prepare display units (random or SI-only)
      const pickUnit = (key) => state.unitsRandom ? choice(UNITS[key]) : UNITS[key][0];
      const u_v = pickUnit('v');
      const u_f = pickUnit('f');
      const u_l = pickUnit('lambda');

      // compute display values from SI
      const show = {
        v: v / u_v.k,
        f: f / u_f.k,
        lambda: lambda / u_l.k,
      };

      // build question object
      return {
        missing,
        given: Object.freeze({
          v: missing==='v'? null : { value: show.v, unit: u_v.label, k: u_v.k },
          f: missing==='f'? null : { value: show.f, unit: u_f.label, k: u_f.k },
          lambda: missing==='lambda'? null : { value: show.lambda, unit: u_l.label, k: u_l.k },
        }),
        // correct answer in SI
        answerSI: { v, f, lambda },
        // what units the user can choose for the answer
        answerUnits: UNITS[missing]
      };
    }

    function renderQuestion(q){
      const givenDiv = document.getElementById('given');
      const ansUnit = document.getElementById('ansUnit');
      ansUnit.innerHTML = '';
      q.answerUnits.forEach(u=>{
        const opt = document.createElement('option');
        opt.value = u.label;
        opt.textContent = u.label;
        ansUnit.appendChild(opt);
      });

      const rows = [];
      ['v','f','lambda'].forEach(key=>{
        const g = q.given[key];
        if(g){
          rows.push(`<div class="row"><div class="label">${NAME[key]} (${SYMBOL[key]}):</div><div class="value">${fmt(g.value, state.sigfigs)} <span class="muted">${g.unit}</span></div></div>`);
        } else {
          rows.push(`<div class="row"><div class="label">Find:</div><div class="value">${NAME[key]} <span class="muted">(${SYMBOL[key]})</span></div></div>`);
        }
      });

      givenDiv.innerHTML = rows.join('');
      document.getElementById('steps').textContent = 'Steps will appear here after you check or reveal the solution.';
      document.getElementById('feedback').innerHTML = '';
      document.getElementById('answer').value = '';
      document.getElementById('answer').focus();

      // Update mode pill
      document.getElementById('modePill').textContent = state.unitsRandom ? 'Randomised Units' : 'SI Units';
    }

    function checkAnswer(){
      const q = state.question;
      const ansVal = parseFloat(document.getElementById('answer').value);
      if(isNaN(ansVal)){
        showFeedback('Please enter a number for your answer.', 'bad');
        return;
      }
      const unitLabel = document.getElementById('ansUnit').value;
      const unitObj = q.answerUnits.find(u=>u.label===unitLabel);
      const k = unitObj.k; // factor from SI to displayed unit

      // correct in chosen unit
      const correctSI = q.answerSI[q.missing];
      const correctInUnit = correctSI / k;

      const relErr = Math.abs((ansVal - correctInUnit) / correctInUnit);
      const ok = relErr <= state.tolPct/100;

      if(ok){
        state.score += 10;
        state.streak += 1;
      } else {
        state.streak = 0;
      }
      updateScore();

      // Build feedback + steps
      const fb = ok ? `✅ Correct! ${SYMBOL[q.missing]} ≈ ${fmt(correctInUnit, state.sigfigs)} ${unitLabel}`
                    : `❌ Not quite. Expected about ${fmt(correctInUnit, state.sigfigs)} ${unitLabel} (your error ${(relErr*100).toFixed(1)}%).`;
      showFeedback(fb, ok? 'ok':'bad');

      const steps = buildSteps(q, unitLabel);
      document.getElementById('steps').innerHTML = steps;
    }

    function buildSteps(q, answerUnitLabel){
      // Show: convert to SI, formula, substitute, compute, convert to requested unit
      const g = q.given;
      const lines = [];
      lines.push(`Given:`);
      if(g.v) lines.push(`  v = ${fmt(g.v.value, state.sigfigs)} ${g.v.unit} = ${(g.v.value * g.v.k).toPrecision(state.sigfigs)} m/s`);
      if(g.f) lines.push(`  f = ${fmt(g.f.value, state.sigfigs)} ${g.f.unit} = ${(g.f.value * g.f.k).toPrecision(state.sigfigs)} Hz`);
      if(g.lambda) lines.push(`  λ = ${fmt(g.lambda.value, state.sigfigs)} ${g.lambda.unit} = ${(g.lambda.value * g.lambda.k).toPrecision(state.sigfigs)} m`);

      const missing = q.missing;
      let formula;
      if(missing==='v') formula = 'v = f · λ';
      if(missing==='f') formula = 'f = v / λ';
      if(missing==='lambda') formula = 'λ = v / f';
      lines.push(`\nFormula: ${formula}`);

      const v = q.answerSI.v;
      const f = q.answerSI.f;
      const l = q.answerSI.lambda;
      if(missing==='v') lines.push(`Substitute: v = ${f.toPrecision(state.sigfigs)} × ${l.toPrecision(state.sigfigs)} = ${(v).toPrecision(state.sigfigs)} m/s`);
      if(missing==='f') lines.push(`Substitute: f = ${v.toPrecision(state.sigfigs)} / ${l.toPrecision(state.sigfigs)} = ${(f).toPrecision(state.sigfigs)} Hz`);
      if(missing==='lambda') lines.push(`Substitute: λ = ${v.toPrecision(state.sigfigs)} / ${f.toPrecision(state.sigfigs)} = ${(l).toPrecision(state.sigfigs)} m`);

      const ansUnits = q.answerUnits.find(u=>u.label===answerUnitLabel) || q.answerUnits[0];
      const target = q.answerSI[missing] / ansUnits.k;
      lines.push(`Convert to ${answerUnitLabel}: ${(target).toPrecision(state.sigfigs)} ${answerUnitLabel}`);

      return `<pre>${lines.join('\n')}</pre>`;
    }

    function showFeedback(text, type){
      const box = document.getElementById('feedback');
      box.className = 'status ' + (type || 'ok');
      box.textContent = text;
    }

    function updateScore(){
      document.getElementById('score').textContent = state.score;
      document.getElementById('streak').textContent = state.streak;
    }

    function newQuestion(fromQuery=null){
      state.sigfigs = parseInt(document.getElementById('sigfigs').value || '3', 10);
      const q = fromQuery ? hydrateFromQuery(fromQuery) : makeQuestion();
      state.question = q;
      renderQuestion(q);
      // Update URL with a shareable query
      const params = {
        m: q.missing,
        vv: q.given.v? q.given.v.value.toPrecision(6) : '',
        vu: q.given.v? q.given.v.unit : '',
        vk: q.given.v? q.given.v.k : '',
        fv: q.given.f? q.given.f.value.toPrecision(6) : '',
        fu: q.given.f? q.given.f.unit : '',
        fk: q.given.f? q.given.f.k : '',
        lv: q.given.lambda? q.given.lambda.value.toPrecision(6) : '',
        lu: q.given.lambda? q.given.lambda.unit : '',
        lk: q.given.lambda? q.given.lambda.k : '',
        ur: state.unitsRandom ? 1 : 0,
      };
      const query = encodeQuery(params);
      history.replaceState(null, '', '?' + query);
    }

    function hydrateFromQuery(q){
      const missing = q.m;
      const gv = (val, unit, k) => val? { value: parseFloat(val), unit, k: parseFloat(k) } : null;
      const given = {
        v: missing==='v'? null : gv(q.vv, q.vu, q.vk),
        f: missing==='f'? null : gv(q.fv, q.fu, q.fk),
        lambda: missing==='lambda'? null : gv(q.lv, q.lu, q.lk),
      };
      // Recover SI answer
      const vSI = given.v? given.v.value*given.v.k : null;
      const fSI = given.f? given.f.value*given.f.k : null;
      const lSI = given.lambda? given.lambda.value*given.lambda.k : null;
      const answerSI = { v: vSI ?? fSI*lSI, f: fSI ?? vSI/lSI, lambda: lSI ?? vSI/fSI };
      return { missing, given, answerSI, answerUnits: UNITS[missing] };
    }

    // Events
    document.getElementById('checkBtn').addEventListener('click', checkAnswer);
    document.getElementById('newBtn').addEventListener('click', ()=> newQuestion());
    document.getElementById('hintBtn').addEventListener('click', ()=>{
      const q = state.question; if(!q) return;
      const hint = q.missing==='v' ? 'Recall: speed = frequency × wavelength' :
                   q.missing==='f' ? 'Rearrange: f = v / λ' : 'Rearrange: λ = v / f';
      showFeedback('Hint: ' + hint, 'warn');
    });
    document.getElementById('solutionBtn').addEventListener('click', ()=>{
      const q = state.question; if(!q) return;
      const unitLabel = document.getElementById('ansUnit').value;
      const steps = buildSteps(q, unitLabel);
      document.getElementById('steps').innerHTML = steps;
    });
    document.getElementById('toggleUnits').addEventListener('click', ()=>{
      state.unitsRandom = !state.unitsRandom;
      document.getElementById('toggleUnits').textContent = 'Toggle Units: ' + (state.unitsRandom? 'Random' : 'SI only');
      newQuestion();
    });
    document.getElementById('sigfigs').addEventListener('change', ()=>{
      state.sigfigs = parseInt(document.getElementById('sigfigs').value, 10);
      renderQuestion(state.question);
    });
    document.getElementById('copyLinkBtn').addEventListener('click', ()=>{
      navigator.clipboard.writeText(location.href).then(()=>{
        showFeedback('Link copied to clipboard. Paste to share this exact question!', 'ok');
      }).catch(()=>{
        showFeedback('Could not copy link. You can still share the URL shown in your browser.', 'warn');
      });
    });

    document.addEventListener('keydown', (e)=>{
      if(e.key==='Enter') checkAnswer();
      if(e.key.toLowerCase()==='n') newQuestion();
    });

    // Init
    const qparams = decodeQuery();
    if(qparams){ state.unitsRandom = (qparams.ur|0)===1; }
    newQuestion(qparams);
  </script>
</body>
</html>
