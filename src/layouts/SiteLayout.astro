---
const { title = "Charlotte McMain — Science Lab" } = Astro.props;
const pathname = Astro.url.pathname;

const links = [
  { href: "/", label: "Home" },
  {
    label: "Subjects",
    children: [
      {
        href: "/physics/",
        label: "Physics",
        children: [
          { href: "/physics/ks3/", label: "KS3" },
          { href: "/physics/gcse/", label: "GCSE" },
          { href: "/physics/a-level/", label: "A-Level" },
        ],
      },
      { href: "/maths/", label: "Maths" },
      { href: "/engineering/", label: "Engineering" },
    ],
  },
  { href: "/science-club/", label: "Science Club" },
];

function isActive(href) {
  if (!href) return false;
  if (href === "/") return pathname === "/";
  return pathname.startsWith(href);
}
function parentActive(node) {
  if (!node) return false;
  if (node.href && isActive(node.href)) return true;
  return (node.children || []).some(child => parentActive(child));
}
---
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>

    <!-- Load global CSS from /public (guaranteed) -->
    <link rel="stylesheet" href="/styles/globals.css" />

    <!-- (Optional) Preload main font for snappier first paint -->
    <!-- <link rel="preload" href="/fonts/CharlotteSans-Regular.ttf" as="font" type="font/ttf" crossorigin> -->
  </head>
  <body>
    <aside class="sidebar">
      <!-- Centered logo only -->
      <div class="logo-container">
        <a href="/" aria-label="Charlotte McMain — Home">
          <img
            src="/brand/logo-round.svg"
            alt="Charlotte McMain logo"
            class="brand-img"
            width="160"
            height="160"
          />
        </a>
      </div>

      <!-- Left-aligned nav -->
      <nav class="nav">
        {links.map(link => (
          link.children ? (
            <div class="nav-group">
              <span class={`nav-group-title ${parentActive({ children: link.children }) ? "active" : ""}`}>
                {link.label}
              </span>
              <div class="nav-sub">
                {link.children.map(child => (
                  child.children ? (
                    <div class="nav-branch">
                      <a
                        href={child.href}
                        class={`nav-link ${isActive(child.href) ? "active" : ""}`}
                        aria-current={isActive(child.href) ? "page" : undefined}
                      >
                        {child.label}
                      </a>
                      <div class="nav-sub depth-2">
                        {child.children.map(grand => (
                          <a
                            href={grand.href}
                            class={`nav-link ${isActive(grand.href) ? "active" : ""}`}
                            aria-current={isActive(grand.href) ? "page" : undefined}
                          >
                            {grand.label}
                          </a>
                        ))}
                      </div>
                    </div>
                  ) : (
                    <a
                      href={child.href}
                      class={`nav-link ${isActive(child.href) ? "active" : ""}`}
                      aria-current={isActive(child.href) ? "page" : undefined}
                    >
                      {child.label}
                    </a>
                  )
                ))}
              </div>
            </div>
          ) : (
            <a
              href={link.href}
              class={`nav-link ${isActive(link.href) ? "active" : ""}`}
              aria-current={isActive(link.href) ? "page" : undefined}
            >
              {link.label}
            </a>
          )
        ))}
      </nav>
    </aside>

    <main class="content">
      <slot />
    </main>
  </body>
</html>

<style>
/* No :root here — globals.css owns colours & fonts */

* { box-sizing: border-box; }
html, body { height: 100%; }

body {
  margin: 0;
  display: grid;
  grid-template-columns: 250px 1fr;
  min-height: 100vh;
  /* font + colours come from globals.css */
}

/* Sidebar shell */
.sidebar {
  background: var(--bg);
  color: var(--text);
  padding: 1.25rem 1rem;
  position: sticky;
  top: 0;
  height: 100dvh;
  border-right: 1px solid rgba(255,255,255,.08);

  display: flex;
  flex-direction: column;
  justify-content: flex-start;
}

/* Center the logo only */
.logo-container {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-bottom: 1.25rem;
}
.brand-img {
  display: block;
  max-width: 180px; /* change size here */
  width: 100%;
  height: auto;
}

/* Nav stays left-aligned */
.nav {
  display: flex;
  flex-direction: column;
  gap: .25rem;
  text-align: left;
}
.nav-link {
  display: block;
  padding: .55rem .75rem;
  border-radius: .6rem;
  color: var(--text);
  text-decoration: none;
  opacity: .95;
}
.nav-link:hover { background: var(--bg-hover); }
.nav-link.active { background: var(--brand-navy); color: #fff; }

.nav-group { margin-top: .5rem; }
.nav-group-title {
  display: block;
  padding: .4rem .75rem;
  color: var(--muted);
  font-size: .85rem;
  text-transform: uppercase;
  letter-spacing: .05em;
}
.nav-group-title.active { color: #fff; }

.nav-branch { margin-top: .25rem; }
.nav-sub { display: flex; flex-direction: column; gap: .25rem; margin-left: 1rem; }
.nav-sub.depth-2 { margin-left: 1.5rem; }

/* Content area */
.content {
  padding: 2rem min(6vw, 3rem);
  max-width: 1000px;
  width: 100%;
}
</style>
