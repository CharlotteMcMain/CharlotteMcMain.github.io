---
import { getCollection } from "astro:content";
import SiteLayout from "../../../layouts/SiteLayout.astro";

// Grab all posts in the A-level folder
const posts = (await getCollection("posts"))
  .filter((p) => p.id.startsWith("physics/a-level/"))
  .map((p) => {
    const data: any = p.data;
    const updated = data.updatedDate ?? data.updated ?? data.pubDate ?? data.date;
    return {
      ...p,
      _updated: updated ? new Date(updated) : new Date(0),
    };
  });

// Sort by updated date and take top 5
const recent = [...posts]
  .sort((a, b) => b._updated.getTime() - a._updated.getTime())
  .slice(0, 5);

// Main course topics
const topics = [
  { title: "Practical Skills", href: "/physics/a-level/practical-skills/" },
  { title: "Measurements and Units", href: "/physics/a-level/measurements-and-units/" },
  { title: "Forces & Motion", href: "/physics/a-level/forces-and-motion/" },
  { title: "Electrons, Waves and Photons", href: "/physics/a-level/electrons-waves-photons/" },
  { title: "Newtonian World and Astrophysics", href: "/physics/a-level/newtonian-world-and-astrophysics/" },
  { title: "Particles and Medical Physics", href: "/physics/a-level/particles-and-medical-physics/" },
];
---

<SiteLayout title="A-level Physics — Charlotte McMain">
  <h1>A-level Physics</h1>
  <p>Main course topics and the most recently updated resources.</p>

  <!-- Main topics -->
  <section class="grid" aria-label="Main topics">
    {topics.map((t) => (
      <a class="tile" href={t.href}>
        <span class="tileTitle">{t.title}</span>
        <span class="tileHint">Explore →</span>
      </a>
    ))}
  </section>

  <!-- Recent content -->
  <section class="recent" aria-label="Most recent">
    <div class="recentHeader">
      <h2>Recently updated</h2>
      <a class="seeAll" href="/physics/a-level/all/">See all</a>
    </div>

    <ol class="recentList">
      {recent.map((p) => {
        const d: any = p.data;
        const date = d.updatedDate ?? d.updated ?? d.pubDate ?? d.date;
        return (
          <li class="recentItem">
            <a class="recentLink" href={`/${p.id.replace(/\.mdx?$/, "")}/`}>
              <span class="recentTitle">{d.title ?? p.id}</span>
              {date && (
                <time class="recentDate" datetime={new Date(date).toISOString()}>
                  {new Date(date).toLocaleDateString("en-GB", {
                    day: "2-digit",
                    month: "short",
                    year: "numeric",
                  })}
                </time>
              )}
            </a>
          </li>
        );
      })}
    </ol>
  </section>
</SiteLayout>

<style>
  .grid {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 1rem;
    margin: 1.5rem 0 2.5rem;
  }

  .tile {
    grid-column: span 6;
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    padding: 1rem;
    border: 2px solid var(--callout-border, rgba(255,255,255,.15));
    border-radius: 14px;
    text-decoration: none;
    background: var(--callout-bg, rgba(255,255,255,.03));
  }

  .tile:hover {
    transform: translateY(-1px);
  }

  .tileTitle {
    font-weight: 700;
  }

  .tileHint {
    opacity: 0.75;
    font-size: 0.95rem;
  }

  @media (max-width: 720px) {
    .tile {
      grid-column: span 12;
    }
  }

  .recentHeader {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: 1rem;
  }

  .seeAll {
    text-decoration: none;
    opacity: 0.8;
  }

  .seeAll:hover {
    opacity: 1;
  }

  .recentList {
    margin: 0.75rem 0 0;
    padding-left: 1.1rem;
  }

  .recentItem {
    margin: 0.3rem 0;
  }

  .recentLink {
    display: flex;
    justify-content: space-between;
    gap: 1rem;
    text-decoration: none;
  }

  .recentTitle {
    font-weight: 600;
  }

  .recentDate {
    opacity: 0.7;
    white-space: nowrap;
  }
</style>