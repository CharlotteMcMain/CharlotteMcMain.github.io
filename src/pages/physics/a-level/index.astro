---
import { getCollection } from "astro:content";
import SiteLayout from "../../../layouts/SiteLayout.astro";

const posts = (await getCollection("posts"))
  .filter((p) => p.id.startsWith("physics/a-level/"))
  .map((p) => {
    const data: any = p.data;
    const updated = data.updatedDate ?? data.updated ?? data.pubDate ?? data.date;
    return { ...p, _updated: updated ? new Date(updated) : new Date(0) };
  });

const recent = [...posts].sort((a, b) => b._updated.getTime() - a._updated.getTime()).slice(0, 5);

const topics = [
  {
    title: "Practical Skills",
    href: "/physics/a-level/1_practical-skills/",
    img: "/images/physics/a-level/practical-skills.jpg",
    alt: "Practical skills in physics",
  },
  {
    title: "Measurements and Units",
    href: "/physics/a-level/2_measurements-and-units/",
    img: "/images/physics/a-level/2_measurements-and-units.jpg",
    alt: "Measurements and units",
  },
  {
    title: "Forces & Motion",
    href: "/physics/a-level/3_forces-and-motion/",
    img: "/images/physics/a-level/3_forces-and-motion.jpg",
    alt: "Forces and motion",
  },
  {
    title: "Electrons, Waves and Photons",
    href: "/physics/a-level/4_electrons-waves-photons/",
    img: "/images/physics/a-level/4_electrons-waves-photons.jpg",
    alt: "Waves and photons",
  },
  {
    title: "Newtonian World and Astrophysics",
    href: "/physics/a-level/5_newtonian-world-and-astrophysics/",
    img: "/images/physics/a-level/5_newtonian-world-and-astrophysics.jpg",
    alt: "Astrophysics",
  },
  {
    title: "Particles and Medical Physics",
    href: "/physics/a-level/6_particles-and-medical-physics/",
    img: "/images/physics/a-level/6_particles-and-medical-physics.jpg",
    alt: "Particles and medical physics",
  },
];
---

<SiteLayout title="A-level Physics — Charlotte McMain">
  <h1>A-level Physics</h1>
  <p>Main course topics and the most recently updated resources.</p>

  <section class="topicGrid" aria-label="Main topics">
    {topics.map((t) => (
      <a class="topicCard" href={t.href}>
        <div class="topicImgWrap">
          <img class="topicImg" src={t.img} alt={t.alt} loading="lazy" />
        </div>
        <div class="topicMeta">
          <span class="topicTitle">{t.title}</span>
          <span class="topicHint">Explore →</span>
        </div>
      </a>
    ))}
  </section>

  <section class="recent" aria-label="Most recent">
    <div class="recentHeader">
      <h2>Recently updated</h2>
      <a class="seeAll" href="/physics/a-level/all/">See all</a>
    </div>

    <ol class="recentList">
      {recent.map((p) => {
        const d: any = p.data;
        const date = d.updatedDate ?? d.updated ?? d.pubDate ?? d.date;
        return (
          <li class="recentItem">
            <a class="recentLink" href={`/${p.id.replace(/\.mdx?$/, "")}/`}>
              <span class="recentTitle">{d.title ?? p.id}</span>
              {date && (
                <time class="recentDate" datetime={new Date(date).toISOString()}>
                  {new Date(date).toLocaleDateString("en-GB", { day: "2-digit", month: "short", year: "numeric" })}
                </time>
              )}
            </a>
          </li>
        );
      })}
    </ol>
  </section>
</SiteLayout>

<style>
  .grid {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 1rem;
    margin: 1.5rem 0 2.5rem;
  }

  .tile {
    grid-column: span 6;
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    padding: 1rem;
    border: 2px solid var(--callout-border, rgba(255,255,255,.15));
    border-radius: 14px;
    text-decoration: none;
    background: var(--callout-bg, rgba(255,255,255,.03));
  }

  .tile:hover {
    transform: translateY(-1px);
  }

  .tileTitle {
    font-weight: 700;
  }

  .tileHint {
    opacity: 0.75;
    font-size: 0.95rem;
  }

  @media (max-width: 720px) {
    .tile {
      grid-column: span 12;
    }
  }

  .recentHeader {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: 1rem;
  }

  .seeAll {
    text-decoration: none;
    opacity: 0.8;
  }

  .seeAll:hover {
    opacity: 1;
  }

  .recentList {
    margin: 0.75rem 0 0;
    padding-left: 1.1rem;
  }

  .recentItem {
    margin: 0.3rem 0;
  }

  .recentLink {
    display: flex;
    justify-content: space-between;
    gap: 1rem;
    text-decoration: none;
  }

  .recentTitle {
    font-weight: 600;
  }

  .recentDate {
    opacity: 0.7;
    white-space: nowrap;
  }

  .topicGrid{
    display:grid;
    grid-template-columns:repeat(12, 1fr);
    gap:1rem;
    margin:1.5rem 0 2.5rem;
  }

  .topicCard{
    grid-column:span 4;              /* 3 across on desktop */
    display:flex;
    flex-direction:column;
    text-decoration:none;
    border:2px solid var(--callout-border, rgba(255,255,255,.15));
    border-radius:16px;
    overflow:hidden;
    background:var(--callout-bg, rgba(255,255,255,.03));
  }

  .topicCard:hover{ transform: translateY(-1px); }

  .topicImgWrap{
    aspect-ratio: 4 / 3;             /* makes a nice consistent rectangle */
    width:100%;
    overflow:hidden;
  }

  .topicImg{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }

  .topicMeta{
    padding:0.9rem 1rem;
    display:flex;
    flex-direction:column;
    gap:0.35rem;
  }

  .topicTitle{ font-weight:700; }
  .topicHint{ opacity:.75; font-size:.95rem; }

  @media (max-width: 900px){
    .topicCard{ grid-column: span 6; } /* 2 across */
  }
  @media (max-width: 720px){
    .topicCard{ grid-column: span 12; } /* 1 across */
  }
</style>